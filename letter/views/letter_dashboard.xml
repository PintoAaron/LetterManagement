<?xml version="1.0" encoding="utf-8" ?>
<odoo>
    <!-- Dashboard actions and menus -->
    <record id="letter_dashboard_window" model="ir.actions.act_window">
        <field name="name">Dashboard</field>
        <field name="res_model">letter.type</field>
        <field name="view_mode">kanban,form</field>
    </record>

    <record id="root_menu" model="ir.ui.menu">
        <field name="action" ref="letter_dashboard_window" />
    </record>

    <menuitem
        id="new_letter_menu"
        action="letter_dashboard_window"
        name="New Letter"
        parent="letters_menu"
        sequence="1"
    />

    <!-- Request actions and menus-->
    <record id="letter_window" model="ir.actions.act_window">
        <field name="name">Letters</field>
        <field name="res_model">letter.letter</field>
        <field name="view_mode">tree,form</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                No new letters
            </p>
            <p>
                Let's go to the <a
                    type="action"
                    class="text-primary"
                    name="%(letter.letter_dashboard_window)d"
                >new letter
            </a> menu
            </p>
        </field>
    </record>

    <record id="letter_pipeline_window" model="ir.actions.act_window">
        <field name="name">Letters</field>
        <field name="res_model">letter.letter</field>
        <field name="view_mode">kanban,tree,form</field>
        <field name="context">{'search_default_groupby_stage': 1}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                No new letters
            </p>
            <p>
                Let's go to the <a
                    type="action"
                    class="text-primary"
                    name="%(letter.letter_dashboard_window)d"
                >new letter
            </a> menu
            </p>
        </field>
    </record>

    <menuitem
        action="letter_window"
        id="letter_menu"
        name="Letters"
        parent="letters_menu"
        sequence="10"
    />

    <!-- Dashboad kanban -->
    <record id="letter_type_kanban" model="ir.ui.view">
        <field name="name">letter.type.kanban</field>
        <field name="model">letter.type</field>
        <field name="arch" type="xml">
            <kanban create="0" class="o_modules_kanban" default_order="sequence, id">
                <field name="name" />
                <field name="id" />
                <field name="image" />
                <field name="show_configure_pipeline" />
                <templates>
                    <t t-name="kanban-menu">
                        <a
                            name="action_open_letter_type_stage"
                            type="object"
                            role="menuitem"
                            class="dropdown-item"
                        >Edit Pipelines</a>
                        <a type="edit" class="dropdown-item">Configuration</a>
                    </t>
                    <t t-name="kanban-box">
                        <div class="oe_module_vignette">
                            <t t-if="record.id">
                                <img
                                    t-att-src="kanban_image('letter.type', 'image', record.id.raw_value)"
                                    t-att-title="record.name.value"
                                    t-att-alt="record.name.value"
                                    class="oe_kanban_avatar float-start me-3"
                                    width="64"
                                    height="64"
                                />
                            </t>
                            <div class="oe_module_desc">
                                <h4 class="o_kanban_record_title">
                                    <field name="name" />
                                </h4>
                                <p class="oe_module_name">
                                    <field name="description" />
                                </p>
                                <div
                                    class="oe_module_action d-flex flex-wrap justify-content-start gap-2"
                                    t-if="!selection_mode"
                                >
                                    <button
                                        type="object"
                                        class="btn btn-sm btn-secondary"
                                        name="action_open_letter_pipeline"
                                        context="{'letter_type_id':id}"
                                        invisible="show_configure_pipeline or letter_count == 0"
                                    >
                                        letters: <field name="letter_count" />
                                    </button>
                                    <button
                                        type="object"
                                        class="btn btn-sm btn-secondary"
                                        name="action_open_to_review_pipeline"
                                        invisible="show_configure_pipeline or letter_to_review_count == 0"
                                        context="{'letter_type_id':id}"
                                    >
                                        Todo: <field name="letter_to_review_count" />
                                    </button>
                                    <button
                                        type="object"
                                        class="btn btn-sm btn-primary"
                                        name="action_create_letter"
                                        context="{'letter_type_id':id}"
                                        invisible="show_configure_pipeline"
                                        string="New Letter"
                                    />
                                    <button
                                        type="object"
                                        class="btn btn-sm btn-primary"
                                        name="action_open_letter_type_stage"
                                        context="{'letter_type_id':id}"
                                        string="Configure Pipeline"
                                        invisible="not show_configure_pipeline"
                                    />
                                </div>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>
</odoo>
